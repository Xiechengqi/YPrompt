import{d as L,u as S,r as d,o as U,a as q,c as a,b as s,e as v,w as g,f as p,v as c,t as k,g as h,h as M,i as r,_ as A}from"./index-DU4N4DsR.js";const B={class:"login-container"},D={class:"login-card"},N={key:0,class:"loading-state"},R={key:1,class:"login-content"},$={key:0,class:"login-section"},F={class:"form-group"},I=["disabled"],P={class:"form-group"},T=["disabled"],E={key:0,class:"error-message"},W=["disabled"],Y={key:0},j={key:1},z={key:1,class:"register-link"},G={class:"modal-header"},H={class:"form-group"},J=["disabled"],K={class:"form-group"},O=["disabled"],Q={class:"form-group"},X=["disabled"],Z={key:0,class:"error-message"},ee=["disabled"],se={key:0},oe=L({__name:"LoginView",setup(le){const _=q(),f=S(),b=d({local_auth_enabled:!0,registration_enabled:!0}),u=d({username:"",password:""}),i=d({username:"",password:"",name:""}),y=d(!0),o=d(!1),n=d(""),m=d(!1),V=async()=>{try{const l=await f.getAuthConfig();l&&(b.value=l)}catch(l){console.error("获取认证配置失败:",l)}finally{y.value=!1}},w=async()=>{n.value="",o.value=!0;try{await f.loginWithPassword(u.value.username,u.value.password)?_.push("/"):n.value="用户名或密码错误"}catch(l){n.value="登录失败，请稍后重试",console.error("登录失败:",l)}finally{o.value=!1}},C=async()=>{n.value="",o.value=!0;try{const l=await f.register(i.value.username,i.value.password,i.value.name);l.success?(m.value=!1,await w()):n.value=l.error||"注册失败，请检查输入信息"}catch(l){n.value="注册失败，请检查输入信息",console.error("注册失败:",l)}finally{o.value=!1}};return U(()=>{if(f.isLoggedIn){_.push("/");return}V()}),(l,e)=>{const x=M('else"');return r(),a("div",B,[s("div",D,[e[18]||(e[18]=s("div",{class:"login-header"},[s("h1",{class:"login-title"},"YPrompt"),s("p",{class:"login-subtitle"},"提示词管理系统")],-1)),y.value?(r(),a("div",N,[...e[9]||(e[9]=[s("div",{class:"loading-spinner"},null,-1),s("p",null,"正在加载...",-1)])])):(r(),a("div",R,[b.value.local_auth_enabled?(r(),a("div",$,[s("form",{onSubmit:g(w,["prevent"]),class:"login-form"},[s("div",F,[e[10]||(e[10]=s("label",{for:"username"},"用户名",-1)),p(s("input",{id:"username","onUpdate:modelValue":e[0]||(e[0]=t=>u.value.username=t),type:"text",class:"form-input",placeholder:"请输入用户名",disabled:o.value,required:""},null,8,I),[[c,u.value.username]])]),s("div",P,[e[11]||(e[11]=s("label",{for:"password"},"密码",-1)),p(s("input",{id:"password","onUpdate:modelValue":e[1]||(e[1]=t=>u.value.password=t),type:"password",class:"form-input",placeholder:"请输入密码",disabled:o.value,required:""},null,8,T),[[c,u.value.password]])]),n.value?(r(),a("div",E,k(n.value),1)):v("",!0),s("button",{type:"submit",class:"btn btn-primary btn-block",disabled:o.value},[o.value?(r(),a("span",Y,"登录中...")):(r(),a("span",j,"登录"))],8,W),b.value.registration_enabled?(r(),a("div",z,[e[12]||(e[12]=h(" 还没有账号？ ",-1)),s("a",{onClick:e[2]||(e[2]=g(t=>m.value=!0,["prevent"])),href:"#"},"立即注册")])):v("",!0)],32)])):v("",!0),m.value?(r(),a("div",{key:1,class:"modal-overlay",onClick:e[8]||(e[8]=t=>m.value=!1)},[s("div",{class:"modal-content",onClick:e[7]||(e[7]=g(()=>{},["stop"]))},[s("div",G,[e[13]||(e[13]=s("h2",null,"注册新账号",-1)),s("button",{onClick:e[3]||(e[3]=t=>m.value=!1),class:"modal-close"},"×")]),s("form",{onSubmit:g(C,["prevent"]),class:"register-form"},[s("div",H,[e[14]||(e[14]=s("label",{for:"reg-username"},"用户名",-1)),p(s("input",{id:"reg-username","onUpdate:modelValue":e[4]||(e[4]=t=>i.value.username=t),type:"text",class:"form-input",placeholder:"3-20个字符，字母开头",disabled:o.value,required:""},null,8,J),[[c,i.value.username]])]),s("div",K,[e[15]||(e[15]=s("label",{for:"reg-password"},"密码",-1)),p(s("input",{id:"reg-password","onUpdate:modelValue":e[5]||(e[5]=t=>i.value.password=t),type:"password",class:"form-input",placeholder:"至少8个字符，包含字母和数字",disabled:o.value,required:""},null,8,O),[[c,i.value.password]])]),s("div",Q,[e[16]||(e[16]=s("label",{for:"reg-name"},"显示名称（可选）",-1)),p(s("input",{id:"reg-name","onUpdate:modelValue":e[6]||(e[6]=t=>i.value.name=t),type:"text",class:"form-input",placeholder:"留空则使用用户名",disabled:o.value},null,8,X),[[c,i.value.name]])]),n.value?(r(),a("div",Z,k(n.value),1)):v("",!0),s("button",{type:"submit",class:"btn btn-primary btn-block",disabled:o.value},[o.value?(r(),a("span",se,"注册中...")):v("",!0),p((r(),a("span",null,[...e[17]||(e[17]=[h("注册",-1)])])),[[x]])],8,ee)],32)])])):v("",!0)]))])])}}}),ae=A(oe,[["__scopeId","data-v-062b82c0"]]);export{ae as default};
